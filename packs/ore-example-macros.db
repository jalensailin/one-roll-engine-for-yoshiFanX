{"name":"ORE Simple Roll","type":"chat","author":"il3uYsm1GPjaDdH1","img":"icons/svg/dice-target.svg","scope":"global","command":"/ore 6d 2h 2w #Flavor Text Before %Flavor Text After","folder":null,"sort":0,"permission":{"default":0,"il3uYsm1GPjaDdH1":3},"flags":{"combat-utility-belt":{"macroTrigger":""},"core":{"sourceId":"Macro.rVevjD6UETmY6FJA"}},"_id":"7wJrWK4lU6XYHIWS"}
{"name":"ORE/Sandbox Simple Roll Using Attribute","type":"chat","author":"il3uYsm1GPjaDdH1","img":"icons/svg/dice-target.svg","scope":"global","command":"/ore {@brlregtotal}d {@brlhardtotal}h {@brlwigtotal}w #Flavor Text Before %Flavor Text After","folder":null,"sort":0,"permission":{"default":0,"il3uYsm1GPjaDdH1":3},"flags":{"combat-utility-belt":{"macroTrigger":""},"core":{"sourceId":"Macro.h7J9yPLX2GMtcUa9"}},"_id":"8ADN9LnQVzC9AofL"}
{"name":"ORE/Sandbox Roll From Sheet","type":"script","author":"il3uYsm1GPjaDdH1","img":"icons/svg/dice-target.svg","scope":"global","command":"const ORE = game.oneRollEngine;\n\nlet sheetActor = GetSheetActor(event) || actor; \nconst actorAttributes = sheetActor.data.data.attributes;\n\n\n// Change the following constants after the equals sign, but generally leave the math the same.\n// Follow the same format (actorAttributes.SOMEATTRIBUTENAME.value).\n// If you want to experiment, you can do complex math here.\nconst regDiceTotal = actorAttributes.brlregtotal.value - actorAttributes.penreg.value;\nconst hardDiceTotal = Math.max(actorAttributes.brlhardtotal.value - actorAttributes.penhar.value, 0);\nconst hardDiceValue = 10;\nconst wigDiceTotal = Math.max(actorAttributes.brlwigtotal.value - actorAttributes.penwig.value, 0);\n\nif (regDiceTotal < 0 || hardDiceTotal < 0) {\n  return ui.notifications.warn(\"You are trying to roll fewer than 0 dice. Please check your penalty dice amounts.\")\n}\n\n//Insert flavor text between the quotation marks.\nconst flavorPreText = \"Brawling\";\nconst flavorPostText = \"\";\n\n\n// You should not need to change the code below this comment.\n\nconst roll = ORE.createRawRoll(regDiceTotal);\nconst rollResult = ORE.parseRawRoll(roll, hardDiceTotal, hardDiceValue, wigDiceTotal, flavorPreText, flavorPostText);\n\nlet data = {};\ndata.speaker = { alias: sheetActor.name };\ndata.content = await ORE.getContentFromRollResult(rollResult);\ndata.type = CONST.CHAT_MESSAGE_TYPES.ROLL;\ndata.roll = roll;\ndata.flags = { core: { canPopout: true } };\n\nreturn ChatMessage.create(data, {});\n\n\n\n// All credit to github user Anderware for the following code. \n// Taken from this macro: https://github.com/Anderware/Foundry-Vtt-Sandbox-Macros/blob/main/Macros/Macro%20from%20Actor%20Sheet/Roll_Hit_Dice_1.0.js\n\nfunction GetSheetActor(event) {\n  let returnactor;\n  let actorid = '';\n  let cp = event.composedPath();\n  for (let key in cp) {\n    if (cp.hasOwnProperty(key)) {\n      if ((typeof (cp[key]) !== \"undefined\" && cp[key] !== null)) {\n        if ((typeof (cp[key].classList) !== \"undefined\" && cp[key].classList !== null)) {\n          if (cp[key].classList.contains('sandbox') && cp[key].classList.contains('sheet') && \n            cp[key].classList.contains('actor')) {\n            //console.log(cp[key].id);  //actor-MMwTr94GekOCihrC   or actor-MMwTr94GekOCihrC-6bX8wMQkdZ9OyOQa\n            // get the id from the div\n            actorid = cp[key].id.substring(6);  // length of 'actor-'            \n            // if the actorid is double(ie MwTr94GekOCihrC-6bX8wMQkdZ9OyOQa), then it is a unlinked token, \n            // need to get the actor from the canvas so use the secondary id            \n            if (actorid.length > 16) {\n              // get secondary actor id\n              actorid = actorid.substring(17);\n              //console.log('Token Actor ' + actorid);\n              //token = canvas.tokens.get(actorid);\n              let token = canvas.tokens.placeables.find(y=>y.id==actorid);\n              if (token != null) {\n                returnactor = token.actor;\n              }\n            } else {\n              //console.log('Actor ' + actorid);   // MwTr94GekOCihrC\n              returnactor = game.actors.get(actorid);\n            }\n            // exit for loop\n            break;\n          }\n        }\n      }\n    }\n  }\n  return returnactor;\n}","folder":null,"sort":0,"permission":{"default":0,"il3uYsm1GPjaDdH1":3},"flags":{"combat-utility-belt":{"macroTrigger":""},"exportSource":{"world":"sui-wild-talents","system":"sandbox","coreVersion":"9.269","systemVersion":"0.13.4"},"core":{"sourceId":"Macro.VxdZA8ZFjnLnJgRU"}},"_id":"cnM1JCPexITaF9Cu"}
